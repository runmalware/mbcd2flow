# ЁЯЫбя╕П MBC D2 Flow (`mbcd2flow`)

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Malware Behavior Catalog](https://img.shields.io/badge/Catalog-MBC-blue)](https://github.com/MBCProject/mbc-markdown)
[![Tool-D2](https://img.shields.io/badge/Tool-D2_Diagram-green)](https://d2lang.com/)
[![MBC D2 Flow Example](./assets/mbd2flow_example.png)](./assets/mbd2flow_example.png)


р╣Вр╕Ыр╕гр╣Ар╕Ир╕Бр╕Хр╣Мр╕Щр╕╡р╣Йр╕Цр╕╣р╕Бр╕кр╕гр╣Йр╕▓р╕Зр╕Вр╕╢р╣Йр╕Щр╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕Кр╣Йр╣Ар╕Ыр╣Зр╕Щр╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕бр╕╖р╕нр╣Гр╕Щр╕Бр╕▓р╕г **р╕кр╕╖р╣Ир╕нр╕кр╕▓р╕гр╣Бр╕ер╕░р╕нр╕Шр╕┤р╕Ър╕▓р╕вр╕Чр╕┤р╕ир╕Чр╕▓р╕Зр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ (Attack Path)** р╕Вр╕нр╕Зр╕бр╕▒р╕ер╣Бр╕зр╕гр╣Мр╣Гр╕Щр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ъ Visual Diagram р╣Вр╕Фр╕вр╣Гр╕Кр╣Йр╕ар╕▓р╕йр╕▓ D2 

---

## ЁЯОп р╕Ир╕╕р╕Фр╕Ыр╕гр╕░р╕кр╕Зр╕Др╣Мр╕Вр╕нр╕Зр╣Вр╕Ыр╕гр╣Ар╕Ир╕Бр╕Хр╣М
* **Malware Analysis Support:** р╣Гр╕Кр╣Йр╕Ыр╕гр╕░р╕Бр╕нр╕Ър╕Бр╕▓р╕гр╣Др╕ер╣Ир╣Вр╕Др╣Йр╕Ф (Static Analysis) р╣Ар╕Юр╕╖р╣Ир╕нр╕Др╕▓р╕Фр╣Ар╕Фр╕▓ **Control Flow** р╕зр╣Ир╕▓р╕бр╕▒р╕ер╣Бр╕зр╕гр╣Мр╕Щр╣Ир╕▓р╕Ир╕░р╕Чр╕│р╕нр╕░р╣Др╕гр╕Хр╣Ир╕нр╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Бр╕Юр╕др╕Хр╕┤р╕Бр╕гр╕гр╕бр╕Чр╕╡р╣Ир╕Хр╕гр╕зр╕Ир╕Юр╕Ъ
* **Reverse Engineering Guide:** р╕Кр╣Ир╕зр╕вр╣Гр╕лр╣Й Analyst р╣Др╕бр╣Ир╕лр╕ер╕Зр╕Чр╕▓р╕Зр╣Ар╕Бр╕┤р╕Щр╣Др╕Ы р╕Вр╕Ур╕░р╕Чр╕│ Reversing р╣Вр╕Фр╕вр╕Бр╕▓р╕г Match р╕Юр╕др╕Хр╕┤р╕Бр╕гр╕гр╕бр╣Ар╕Вр╣Йр╕▓р╕Бр╕▒р╕Ъ MBC Objective
* **Incident Communication:** р╣Гр╕Кр╣Йр╕кр╕╖р╣Ир╕нр╕кр╕▓р╕гр╕Бр╕▒р╕Ър╕Чр╕╡р╕б IR/SOC р╣Гр╕лр╣Йр╣Ар╕лр╣Зр╕Щр╕ар╕▓р╕Юр╕Хр╕гр╕Зр╕Бр╕▒р╕Щр╕зр╣Ир╕▓р╕ар╕▒р╕вр╕Др╕╕р╕Бр╕Др╕▓р╕бр╕нр╕вр╕╣р╣Ир╣Гр╕Щр╕гр╕░р╕вр╕░ (Stage) р╣Др╕лр╕Щ

## ЁЯЪА р╕Чр╕│р╣Др╕бр╕Хр╣Йр╕нр╕Зр╣Гр╕Кр╣Й D2?
> D2 р╕нр╕▒р╕Юр╣Ар╕Фр╕Х flow р╣Др╕Фр╣Йр╕Зр╣Ир╕▓р╕в р╕Ьр╕бр╕ер╕нр╕Зр╣Бр╕ер╣Йр╕зр╕Др╣Ир╕нр╕Щр╕Вр╣Йр╕▓р╕Зр╕Цр╕╣р╕Бр╣Гр╕Ир╣Ар╕ер╕вр╣Гр╕Кр╣Йр╕нр╕▒р╕Щр╕Щр╕╡р╣Йр╕Щр╣Ир╕░ 
р╣Бр╕Хр╣Ир╕нр╕▒р╕Щр╕Чр╕╡р╣Ир╕Ир╕гр╕┤р╕З р╕кр╣Ир╕зр╕Щр╕лр╕Щр╕╢р╣Ир╕Зр╕Бр╣Зр╕Др╕╖р╕н
р╣Ар╕Щр╕╖р╣Ир╕нр╕Зр╕Ир╕▓р╕Б D2 р╣Ар╕Ыр╣Зр╕Щ **Declarative Language** р╕Чр╕│р╣Гр╕лр╣Йр╣Ар╕гр╕▓р╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Бр╕Бр╣Йр╣Др╕Вр╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕Зр╕Юр╕др╕Хр╕┤р╕Бр╕гр╕гр╕бр╣Др╕Фр╣Йр╕гр╕зр╕Фр╣Ар╕гр╣Зр╕з р╕гр╕нр╕Зр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Чр╕│ Automation р╣Гр╕Щр╕нр╕Щр╕▓р╕Др╕Х р╣Бр╕ер╕░р╕Чр╕╡р╣Ир╕кр╕│р╕Др╕▒р╕Нр╕Др╕╖р╕н **р╕Ьр╕бр╕Цр╕Щр╕▒р╕Фр╕Др╕гр╕▒р╕Ъ** 

---

## ЁЯУК р╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕Зр╕Бр╕▓р╕гр╣Вр╕Ир╕бр╕Хр╕╡ (5 Phases)
р╣Ар╕гр╕▓р╣Бр╕Ър╣Ир╕Зр╕Бр╕ер╕╕р╣Ир╕бр╕Юр╕др╕Хр╕┤р╕Бр╕гр╕гр╕бр╕Хр╕▓р╕бр╕ер╕│р╕Фр╕▒р╕Ър╣Ар╕лр╕Хр╕╕р╕Бр╕▓р╕гр╕Ур╣М (Chronological Order) р╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╕Зр╣Ир╕▓р╕вр╕Хр╣Ир╕нр╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М:

| Phase | р╕кр╕Цр╕▓р╕Щр╕░ | р╕кр╕╡ | р╕Др╕│р╕нр╕Шр╕┤р╕Ър╕▓р╕в |
| :--- | :--- | :--- | :--- |
| **Phase 1** | **Analysis Avoidance** | ЁЯМС р╣Ар╕Чр╕▓ | р╕Бр╕▓р╕гр╕Юр╕гр╕▓р╕Зр╕Хр╕▒р╕з р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Sandbox/VM/Debugger |
| **Phase 2** | **Execution & Presence** | ЁЯЯб р╣Ар╕лр╕ер╕╖р╕нр╕З | р╕Бр╕▓р╕гр╣Ар╕гр╕┤р╣Ир╕бр╕гр╕▒р╕Щр╕Др╕│р╕кр╕▒р╣Ир╕З р╣Бр╕ер╕░р╕Бр╕▓р╕гр╕Эр╕▒р╕Зр╕Хр╕▒р╕з (Persistence) |
| **Phase 3** | **Internal Operations** | ЁЯЯг р╕бр╣Ир╕зр╕З | р╕кр╕│р╕гр╕зр╕Ир╕гр╕░р╕Ър╕Ъ р╕Вр╣Вр╕бр╕вр╕кр╕┤р╕Чр╕Шр╕┤р╣М р╣Бр╕ер╕░р╕лр╕ер╕Ър╣Ар╕ер╕╡р╣Ир╕вр╕Зр╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕Ир╕▒р╕Ър╕ар╕▓р╕вр╣Гр╕Щ |
| **Phase 4** | **C2 & Data Theft** | ЁЯФ┤ р╣Бр╕Фр╕З | р╕Бр╕▓р╕гр╕Хр╕┤р╕Фр╕Хр╣Ир╕нр╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╣Бр╕бр╣И (C2) р╣Бр╕ер╕░р╕Бр╕▓р╕гр╕Вр╕вр╕▓р╕вр╕Ьр╕е (Lateral) |
| **Phase 5** | **Final Impact** | тЪк р╕Вр╕▓р╕з | р╕Бр╕▓р╕гр╕Ър╕гр╕гр╕ер╕╕р╣Ар╕Ыр╣Йр╕▓р╕лр╕бр╕▓р╕в (Ransomware, DoS, Destruction) |

---

## ЁЯЫая╕П р╕зр╕┤р╕Шр╕╡р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ

1.  р╕Др╕▒р╕Фр╕ер╕нр╕Бр╣Вр╕Др╣Йр╕Фр╕Ир╕▓р╕Бр╣Др╕Яр╕ер╣М [`mbc_flow.d2`](./mbc_flow.d2)
2.  р╕Щр╕│р╣Др╕Ыр╕зр╕▓р╕Зр╣Гр╕Щ [D2 Playground](https://play.d2lang.com/) р╕лр╕гр╕╖р╕нр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Ьр╣Ир╕▓р╕Щ [D2 CLI](https://d2lang.com/tour/install)
3.  **[Future Plan]** р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н Output р╕Ир╕▓р╕Б Sandbox (JSON) р╕лр╕гр╕╖р╕н EDR Logs р╣Ар╕Вр╣Йр╕▓р╕Бр╕▒р╕Ър╕гр╕░р╕Ър╕Ъ **Semi-automate** р╣Ар╕Юр╕╖р╣Ир╕нр╕зр╕▓р╕Фр╣Ар╕кр╣Йр╕Щр╕Др╕зр╕▓р╕бр╕кр╕▒р╕бр╕Юр╕▒р╕Щр╕Шр╣Мр╕Вр╕нр╕Зр╣Ар╕Др╕кр╕Чр╕╡р╣Ир╕Бр╕│р╕ер╕▒р╕Зр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Др╕Фр╣Йр╕Чр╕▒р╕Щр╕Чр╕╡

---

## ЁЯУВ р╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕Зр╣Др╕Яр╕ер╣Мр╣Гр╕Щр╣Вр╕Ыр╕гр╣Ар╕Ир╕Бр╕Хр╣М

* `mbc_flow.d2`: р╣Др╕Яр╕ер╣Мр╕лр╕ер╕▒р╕Бр╕Чр╕╡р╣Ир╕Ър╕гр╕гр╕Ир╕╕р╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕З Behavior р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (Core Logic)
* `assets/`: р╕гр╕╣р╕Ыр╕ар╕▓р╕Юр╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Вр╕нр╕Зр╣Бр╕Ьр╕Щр╕ар╕▓р╕Юр╕Чр╕╡р╣И Render р╣Бр╕ер╣Йр╕з (р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Фр╕╣р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╣Др╕зр╣Ж)

---

## ЁЯдЭ р╣Ар╕Юр╕╖р╣Ир╕нр╕Щр╕Чр╕╡р╣Ир╕кр╕Щр╣Гр╕Ир╕бр╕╡р╕кр╣Ир╕зр╕Щр╕гр╣Ир╕зр╕б (Contribution)
р╕лр╕▓р╕Бр╕Др╕╕р╕Ур╕Юр╕Ър╕Юр╕др╕Хр╕┤р╕Бр╕гр╕гр╕бр╣Гр╕лр╕бр╣Ир╣Ж р╕лр╕гр╕╖р╕нр╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╣Ар╕кр╕Щр╕нр╣Др╕нр╣Ар╕Фр╕╡р╕вр╕Бр╕▓р╕г Mapping р╣Гр╕лр╣Йр╣Бр╕бр╣Ир╕Щр╕вр╕│р╕Вр╕╢р╣Йр╕Щ:
* ЁЯН┤ **Fork** р╣Вр╕Ыр╕гр╣Ар╕Ир╕Бр╕Хр╣Мр╕Щр╕╡р╣Й
* ЁЯФз р╕кр╕гр╣Йр╕▓р╕З **Pull Request**
* ЁЯРЫ р╣Бр╕Ир╣Йр╕Зр╕Ыр╕▒р╕Нр╕лр╕▓р╣Др╕Фр╣Йр╕Чр╕╡р╣И **Issues**: [https://github.com/runmalware/mbcd2flow](https://github.com/runmalware/mbcd2flow)
